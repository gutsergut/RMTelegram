# Интерфейс выбора статей для юридических документов

## Скриншоты настроек компонента

### 1. Вкладка "Legal Documents" в настройках

```
┌────────────────────────────────────────────────────────────────────┐
│ Components > Telegram Магазин > Options                           │
├────────────────────────────────────────────────────────────────────┤
│                                                                    │
│  [ Basic Settings ] [ Payments ] [ Delivery ] [ Legal Documents ] │
│                                                                    │
│  ┌──────────────────────────────────────────────────────────────┐ │
│  │ 📄 Политика конфиденциальности                               │ │
│  │ ┌──────────────────────────────────────────────────────────┐ │ │
│  │ │ Select Article                                    [×] [▼]│ │ │
│  │ └──────────────────────────────────────────────────────────┘ │ │
│  │ Статья с текстом Политики обработки персональных данных.    │ │
│  │ Ссылка будет использоваться в боте при запросе согласия.    │ │
│  └──────────────────────────────────────────────────────────────┘ │
│                                                                    │
│  ┌──────────────────────────────────────────────────────────────┐ │
│  │ ✅ Согласие на обработку ПД                                  │ │
│  │ ┌──────────────────────────────────────────────────────────┐ │ │
│  │ │ Согласие на обработку персональных данных     [×] [Clear]│ │ │
│  │ └──────────────────────────────────────────────────────────┘ │ │
│  │ ID: 124  |  Alias: consent                                   │ │
│  │ Статья с текстом Согласия на обработку ПД.                  │ │
│  └──────────────────────────────────────────────────────────────┘ │
│                                                                    │
│  ┌──────────────────────────────────────────────────────────────┐ │
│  │ 📜 Пользовательское соглашение                               │ │
│  │ ┌──────────────────────────────────────────────────────────┐ │ │
│  │ │ Select Article                                    [×] [▼]│ │ │
│  │ └──────────────────────────────────────────────────────────┘ │ │
│  └──────────────────────────────────────────────────────────────┘ │
│                                                                    │
│  ┌──────────────────────────────────────────────────────────────┐ │
│  │ 📧 Согласие на рассылки                                      │ │
│  │ ┌──────────────────────────────────────────────────────────┐ │ │
│  │ │ Select Article                                    [×] [▼]│ │ │
│  │ └──────────────────────────────────────────────────────────┘ │ │
│  └──────────────────────────────────────────────────────────────┘ │
│                                                                    │
│                         [ Save ] [ Save & Close ] [ Cancel ]       │
└────────────────────────────────────────────────────────────────────┘
```

### 2. Модальное окно выбора статьи (при клике на "Select Article")

```
┌────────────────────────────────────────────────────────────────────┐
│ Select an Article                                           [×]    │
├────────────────────────────────────────────────────────────────────┤
│                                                                    │
│  🔍 Search: [политика конфиденциальности____________] [Search]    │
│                                                                    │
│  Filter by Category: [All Categories ▼]   Status: [All ▼]         │
│                                                                    │
│  ┌──────────────────────────────────────────────────────────────┐ │
│  │ ID │ Title                                  │ Category │ Status││
│  ├────┼────────────────────────────────────────┼──────────┼───────┤│
│  │123 │ Политика конфиденциальности           │ Legal    │ Pub. ││
│  │124 │ Согласие на обработку персональных... │ Legal    │ Pub. ││
│  │125 │ Пользовательское соглашение           │ Legal    │ Pub. ││
│  │126 │ Согласие на получение рассылок        │ Legal    │ Pub. ││
│  └──────────────────────────────────────────────────────────────┘ │
│                                                                    │
│  Selected: Политика конфиденциальности (ID: 123)                  │
│                                                                    │
│                               [ Select ] [ Cancel ]                │
└────────────────────────────────────────────────────────────────────┘
```

### 3. После выбора статьи

```
┌────────────────────────────────────────────────────────────────────┐
│ 📄 Политика конфиденциальности                                    │
├────────────────────────────────────────────────────────────────────┤
│ ┌──────────────────────────────────────────────────────────────┐   │
│ │ ✓ Политика конфиденциальности                         [Clear]│   │
│ └──────────────────────────────────────────────────────────────┘   │
│                                                                    │
│ Article ID: 123                                                    │
│ Alias: privacy                                                     │
│ URL: https://cacao.land/privacy                                    │
│                                                                    │
│ 📝 Preview: Настоящая Политика обработки персональных данных...   │
└────────────────────────────────────────────────────────────────────┘
```

## Технические детали

### Тип поля: `modal_article`

```xml
<field
    name="article_privacy_policy"
    type="modal_article"
    label="COM_RADICALMART_TELEGRAM_ARTICLE_PRIVACY_LABEL"
    description="COM_RADICALMART_TELEGRAM_ARTICLE_PRIVACY_DESC"
    select="true"
    new="true"
    edit="true"
    clear="true"
    filter="integer"
/>
```

**Параметры:**
- `type="modal_article"` — стандартный тип поля Joomla для выбора статей (как в privacyconsent)
- `select="true"` — показывает кнопку "Select" для открытия модального окна
- `new="true"` — показывает кнопку "New" для создания новой статьи
- `edit="true"` — показывает кнопку "Edit" для редактирования выбранной статьи
- `clear="true"` — показывает кнопку "Clear" для очистки выбора
- `filter="integer"` — сохраняет только целое число (ID статьи)
- `addfieldpath="/administrator/components/com_content/models/fields"` — путь к полям компонента com_content### Чтение значения в PHP

```php
use Joomla\CMS\Component\ComponentHelper;

$params = ComponentHelper::getParams('com_radicalmart_telegram');
$articleId = (int) $params->get('article_privacy_policy', 0);

// $articleId = 123
```

### Формирование URL через Router

```php
use Joomla\CMS\Router\Route;

$url = Route::link(
    'site',                                                    // Application
    'index.php?option=com_content&view=article&id=' . $articleId,  // Query
    false,                                                     // XHTML
    Route::TLS_IGNORE,                                        // SSL
    true                                                       // Absolute
);

// Результат: https://cacao.land/privacy
```

**Как формируется короткая ссылка:**
1. Joomla ищет пункт меню для статьи с ID=123
2. Если найден пункт с alias="privacy" → использует его URL
3. Если не найден → генерирует стандартный URL: `/component/content/article/123-politika-konfidencialnosti`
4. Применяет SEF правила из конфигурации Joomla

### Преимущества подхода

✅ **Гибкость URL:**
- Создали пункт меню с alias `privacy` → URL будет `/privacy`
- Переместили в другую категорию → URL обновится автоматически
- Изменили alias статьи → старый URL продолжит работать (редирект 301)

✅ **SEO-оптимизация:**
- Канонические URL через пункты меню
- Метаданные из статьи (title, description, keywords)
- OpenGraph теги из RadicalMicro (если установлен)

✅ **Версионность:**
- История изменений в Joomla (Content History)
- Восстановление предыдущих версий
- Сравнение изменений (diff)

✅ **Права доступа:**
- ACL Joomla для редактирования
- Возможность ограничить доступ по группам
- Workflow для согласования изменений (Joomla 4+)

## Пример использования в боте

### PHP код (UpdateHandler.php)

```php
use Joomla\Component\RadicalMartTelegram\Site\Helper\ConsentHelper;

// Получить URL согласия из настроек
$consentUrl = ConsentHelper::getDocumentUrl('consent');

// Fallback на языковую константу
if (empty($consentUrl)) {
    $consentUrl = Text::_('COM_RADICALMART_TELEGRAM_CONSENT_URL');
}

// Отправить сообщение с ссылкой
$message = Text::sprintf(
    'COM_RADICALMART_TELEGRAM_CONSENT_REQUEST',
    $consentUrl
);

$this->client->sendMessage($chatId, $message, [
    'parse_mode' => 'HTML',
    'reply_markup' => [
        'inline_keyboard' => [[
            ['text' => '✅ Согласен', 'callback_data' => 'consent_accept']
        ]]
    ]
]);
```

### Результат в Telegram

```
┌─────────────────────────────────────────────┐
│ @CacaoLandBot                               │
├─────────────────────────────────────────────┤
│                                             │
│ Для продолжения работы необходимо дать      │
│ согласие на обработку персональных данных:  │
│                                             │
│ 🔗 https://cacao.land/consent               │
│                                             │
│ Пожалуйста, ознакомьтесь с документом и     │
│ нажмите кнопку ниже, если согласны.         │
│                                             │
│         ┌─────────────────────────┐         │
│         │  ✅ Согласен и ознакомлен │         │
│         └─────────────────────────┘         │
│                                             │
└─────────────────────────────────────────────┘
```

## Рекомендации по настройке

### Шаг 1: Создайте категорию для документов

```
Content > Categories > New

Name: Правовые документы
Alias: legal
Description: Юридические документы сайта
Access Level: Public
Status: Published
```

### Шаг 2: Создайте статьи

```
Content > Articles > New (×4)

1. Title: Политика конфиденциальности
   Alias: privacy
   Category: Правовые документы
   Status: Published

2. Title: Согласие на обработку персональных данных
   Alias: consent
   Category: Правовые документы
   Status: Published

3. Title: Пользовательское соглашение
   Alias: terms
   Category: Правовые документы
   Status: Published

4. Title: Согласие на получение рассылок
   Alias: consent-marketing
   Category: Правовые документы
   Status: Published
```

### Шаг 3: Создайте пункты меню (опционально, для красивых URL)

```
Menus > Main Menu > New (×4)

Menu Item Type: Single Article
Article: [выберите соответствующую статью]
Menu Title: [такой же, как у статьи]
Alias: [такой же, как у статьи - важно!]
Parent Item: Правовые документы (создайте heading если нужно)
Access: Public
Status: Published
```

**Результат:**
- `/privacy` → Политика конфиденциальности
- `/consent` → Согласие на ПД
- `/terms` → Пользовательское соглашение
- `/consent-marketing` → Согласие на рассылки

### Шаг 4: Свяжите в настройках компонента

```
Components > Telegram Магазин > Options > Legal Documents

1. Политика конфиденциальности → Select → [выберите статью]
2. Согласие на обработку ПД → Select → [выберите статью]
3. Пользовательское соглашение → Select → [выберите статью]
4. Согласие на рассылки → Select → [выберите статью]

Save & Close
```

---

**Дата создания:** 10 ноября 2025 г.
**Версия компонента:** 5.0.1+
