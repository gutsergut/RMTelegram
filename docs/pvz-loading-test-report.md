# ะัััั ะพ ัะตััะธัะพะฒะฐะฝะธะธ ะทะฐะณััะทะบะธ ะะะ

## ะะฐัะฐ ัะตััะธัะพะฒะฐะฝะธั
5 ะฝะพัะฑัั 2025 ะณ., 15:51:44

## ะกัะฐััั
โ **ะะะฃะกะะะจะะ** - API ะบะปัั ะฝะตะดะตะนััะฒะธัะตะปะตะฝ

## ะะตะทัะปััะฐัั ะฟัะพะฒะตัะบะธ ะฑะฐะทั ะดะฐะฝะฝัั

### ะะตัะฐะดะฐะฝะฝัะต ะพะฑะฝะพะฒะปะตะฝะธะน
```
โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโ
โ Provider    โ Last Fetch           โ Last Total โ
โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโค
โ cdek        โ 2025-11-05 15:51:44  โ          0 โ
โ x5          โ 2025-11-05 15:51:45  โ          0 โ
โ yataxi      โ 2025-11-05 15:51:44  โ          0 โ
โโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโ
```

**ะัะฒะพะดั:**
- โ ะะฑะฝะพะฒะปะตะฝะธะต ะทะฐะฟััะบะฐะตััั (Last Fetch ะพะฑะฝะพะฒะปัะตััั)
- โ ะะฐะฟะธัะธ ะฒ ะผะตัะฐะดะฐะฝะฝัะต ัะพััะฐะฝััััั
- โ ะะพะปะธัะตััะฒะพ ัะพัะตะบ = 0 ะดะปั ะฒัะตั ะฟัะพะฒะฐะนะดะตัะพะฒ

### ะขะพัะบะธ ะฒ ะฑะฐะทะต
**ะัะตะณะพ ัะพัะตะบ:** 0

### ะะฐัััะพะนะบะธ ะบะพะผะฟะพะฝะตะฝัะฐ
- **API Key:** `4446add5de10615e33d5834f0c931925` (32 ัะธะผะฒะพะปะฐ)
- **Providers:** `yataxi,cdek,x5`

## ะะตะทัะปััะฐัั ัะตััะฐ API

### ะััะผะพะน ะทะฐะฟัะพั ะบ ApiShip API

**Endpoint:** `https://api.apiship.ru/v1/lists/points`

**ะะตะทัะปััะฐัั ะดะปั ะฒัะตั ะฟัะพะฒะฐะนะดะตัะพะฒ:**
```
Provider: yataxi
  HTTP Code: 401
  Message: ะะตะบะพััะตะบัะฝัะน ะบะปัั ะฑะตะทะพะฟะฐัะฝะพััะธ

Provider: cdek
  HTTP Code: 401
  Message: ะะตะบะพััะตะบัะฝัะน ะบะปัั ะฑะตะทะพะฟะฐัะฝะพััะธ

Provider: x5
  HTTP Code: 401
  Message: ะะตะบะพััะตะบัะฝัะน ะบะปัั ะฑะตะทะพะฟะฐัะฝะพััะธ
```

## ะะธะฐะณะฝะพััะธะบะฐ

### โ ะงัะพ ัะฐะฑะพัะฐะตั
1. ะะพะผะฟะพะฝะตะฝั ัััะฐะฝะพะฒะปะตะฝ ะฟัะฐะฒะธะปัะฝะพ
2. ะะฐะทะฐ ะดะฐะฝะฝัั ะฝะฐัััะพะตะฝะฐ ะบะพััะตะบัะฝะพ
3. ะะฑะฝะพะฒะปะตะฝะธะต ะทะฐะฟััะบะฐะตััั ะฑะตะท ะพัะธะฑะพะบ PHP
4. ะะตัะฐะดะฐะฝะฝัะต ัะพััะฐะฝััััั ะฒ ะะ
5. ะะพะณะธัะพะฒะฐะฝะธะต ัะฐะฑะพัะฐะตั (ะฒะตััะธั 0.1.9)

### โ ะงัะพ ะฝะต ัะฐะฑะพัะฐะตั
1. **API ะบะปัั ะฝะตะดะตะนััะฒะธัะตะปะตะฝ** - ApiShip ะฒะพะทะฒัะฐัะฐะตั 401
2. ะขะพัะบะธ ะฝะต ะทะฐะณััะถะฐัััั (0 ัะพัะตะบ)

## ะะพะทะผะพะถะฝัะต ะฟัะธัะธะฝั

### 1. API ะบะปัั ะฟัะพััะพัะตะฝ ะธะปะธ ะฝะตะดะตะนััะฒะธัะตะปะตะฝ
**ะะตัะพััะฝะพััั:** ๐ด ะะซะกะะะะฏ

**ะัะธะทะฝะฐะบะธ:**
- HTTP 401 Unauthorized
- ะกะพะพะฑัะตะฝะธะต: "ะะตะบะพััะตะบัะฝัะน ะบะปัั ะฑะตะทะพะฟะฐัะฝะพััะธ"
- ะะฐะฑะพัะฐะตั ะดะปั ะฒัะตั ะฟัะพะฒะฐะนะดะตัะพะฒ ะพะดะธะฝะฐะบะพะฒะพ

**ะะตัะตะฝะธะต:**
ะะพะปััะธัั ะฝะพะฒัะน API ะบะปัั ะฒ ะปะธัะฝะพะผ ะบะฐะฑะธะฝะตัะต ApiShip

### 2. API ะบะปัั ะดะปั ัะตััะพะฒะพะน ััะตะดั
**ะะตัะพััะฝะพััั:** ๐ก ะกะะะะะฏะฏ

**ะัะธะทะฝะฐะบะธ:**
- ะะปัั ัะฐะฑะพัะฐะป ัะฐะฝััะต
- ะกะตะนัะฐั ะฝะต ัะฐะฑะพัะฐะตั

**ะะตัะตะฝะธะต:**
ะัะพะฒะตัะธัั, ะดะปั ะบะฐะบะพะน ััะตะดั ัะพะทะดะฐะฝ ะบะปัั (ัะตัั/prod)

### 3. ะะณัะฐะฝะธัะตะฝะธั ะฟะพ IP
**ะะตัะพััะฝะพััั:** ๐ข ะะะะะะฏ

**ะัะธะทะฝะฐะบะธ:**
- ะะปัั ะฟัะฐะฒะธะปัะฝัะน
- ะะพ API ะพัะบะฐะทัะฒะฐะตั

**ะะตัะตะฝะธะต:**
ะัะพะฒะตัะธัั whitelist IP ะฒ ะฝะฐัััะพะนะบะฐั ApiShip

### 4. ะัะพะฑะปะตะผะฐ ั ัะพัะผะฐัะพะผ ะทะฐะณะพะปะพะฒะบะฐ Authorization
**ะะตัะพััะฝะพััั:** ๐ก ะกะะะะะฏะฏ

**ะขะตะบััะธะน ะบะพะด ะฒ ApiShipHelper.php (ัััะพะบะฐ 521):**
```php
$headers = [
    'Content-Type'  => 'application/json',
    'authorization' => $token  // โ ะะพะปะถะฝะพ ะฑััั 'Bearer ' . $token
];
```

**ะัะฐะฒะธะปัะฝัะน ัะพัะผะฐั:**
```php
$headers = [
    'Content-Type'  => 'application/json',
    'Authorization' => 'Bearer ' . $token  // โ ะก ะฟัะตัะธะบัะพะผ Bearer
];
```

## ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ัะตัะตะฝะธั

### ะัะธะพัะธัะตั 1: ะะพะปััะธัั ะฝะพะฒัะน API ะบะปัั

1. ะะพะนะดะธัะต ะฝะฐ https://apiship.ru
2. ะะตัะตะนะดะธัะต ะฒ **ะะฐัััะพะนะบะธ โ API**
3. ะกะพะทะดะฐะนัะต ะฝะพะฒัะน API ะบะปัั ะธะปะธ ัะบะพะฟะธััะนัะต ะดะตะนััะฒัััะธะน
4. ะะฑะฝะพะฒะธัะต ะบะปัั ะฒ ะฝะฐัััะพะนะบะฐั ะบะพะผะฟะพะฝะตะฝัะฐ:
   - **ะะพะผะฟะพะฝะตะฝัั โ RadicalMart Telegram โ Configuration**
   - ะะพะปะต **ApiShip API Key**
   - ะกะพััะฐะฝะธัะต

### ะัะธะพัะธัะตั 2: ะัะพะฒะตัะธัั ัะพัะผะฐั ะทะฐะณะพะปะพะฒะบะฐ (ะตัะปะธ ะฝะพะฒัะน ะบะปัั ะฝะต ะฟะพะผะพะถะตั)

ะัะปะธ ะฟะพัะปะต ะฟะพะปััะตะฝะธั ะฝะพะฒะพะณะพ ะบะปััะฐ ะฟัะพะฑะปะตะผะฐ ะพััะฐัััั, ะฝัะถะฝะพ ะธัะฟัะฐะฒะธัั ะฒ ะฟะปะฐะณะธะฝะต:

**ะคะฐะนะป:** `plugins/radicalmart_shipping/apiship/src/Helper/ApiShipHelper.php`

**ะะทะผะตะฝะธัั ะฒ 3 ะผะตััะฐั:**

1. ะะตัะพะด `sendGetRequest` (ัััะพะบะฐ ~521):
```php
$headers = [
    'Content-Type'  => 'application/json',
    'Authorization' => 'Bearer ' . $token  // ะะทะผะตะฝะธัั
];
```

2. ะะตัะพะด `sendPostRequest` (ัััะพะบะฐ ~441):
```php
$headers = [
    'Content-Type'  => 'application/json',
    'Authorization' => 'Bearer ' . $token  // ะะทะผะตะฝะธัั
];
```

3. ะะตัะพะด `sendDeleteRequest` (ัััะพะบะฐ ~575):
```php
$headers = [
    'Content-Type'  => 'application/json',
    'Authorization' => 'Bearer ' . $token  // ะะทะผะตะฝะธัั
];
```

### ะัะธะพัะธัะตั 3: ะขะตััะธัะพะฒะฐะฝะธะต ะฟะพัะปะต ะธะทะผะตะฝะตะฝะธะน

ะะพัะปะต ะฟะพะปััะตะฝะธั ะฝะพะฒะพะณะพ ะบะปััะฐ:

1. ะะฑะฝะพะฒะธัะต ะฝะฐัััะพะนะบะธ ะบะพะผะฟะพะฝะตะฝัะฐ
2. ะะฐะฟัััะธัะต ะพะฑะฝะพะฒะปะตะฝะธะต ะะะ
3. ะัะพะฒะตัััะต ะปะพะณะธ:
   ```bash
   notepad administrator/logs/com_radicalmart_telegram.php
   ```
4. ะัะพะฒะตัััะต ะฑะฐะทั ะดะฐะฝะฝัั:
   ```bash
   php check_apiship_db.php
   ```

## ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั ะฟะพัะปะต ะธัะฟัะฐะฒะปะตะฝะธั

### ะ ะฑะฐะทะต ะดะฐะฝะฝัั:
```
โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโ
โ Provider    โ Last Fetch           โ Last Total โ
โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโค
โ yataxi      โ 2025-11-05 16:00:00  โ       1234 โ
โ cdek        โ 2025-11-05 16:00:15  โ       2456 โ
โ x5          โ 2025-11-05 16:00:30  โ       3099 โ
โโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโ

ะัะตะณะพ ัะพัะตะบ ะฒ ะฑะฐะทะต: 6789
```

### ะ ะปะพะณะฐั:
```
2025-11-05 16:00:00 INFO ApiShip fetch started: providers=yataxi,cdek,x5
2025-11-05 16:00:02 INFO ApiShip provider 'yataxi': total points = 1234
2025-11-05 16:00:03 INFO ApiShip provider 'yataxi': fetched 500 points at offset 0
2025-11-05 16:00:04 INFO ApiShip provider 'yataxi': fetched 500 points at offset 500
2025-11-05 16:00:05 INFO ApiShip provider 'yataxi': fetched 234 points at offset 1000
...
2025-11-05 16:00:30 INFO ApiShip fetch completed: total=6789
```

### ะ ัะตััะต API:
```
Testing provider: yataxi
  HTTP Code: 200
  Total points: 1234
  Rows count: 1
```

## ะะพะฟะพะปะฝะธัะตะปัะฝะฐั ะธะฝัะพัะผะฐัะธั

### ะะตััะธั ะบะพะผะฟะพะฝะตะฝัะฐ
- **ะขะตะบััะฐั:** 0.1.9
- **ะะฐะบะตั:** `pkg_radicalmart_telegram-0.1.9.zip`

### ะัะฟัะฐะฒะปะตะฝะธั ะฒ ะฒะตััะธะธ 0.1.9
- โ ะะพะณะธัะพะฒะฐะฝะธะต ัะฐะฑะพัะฐะตั (ะธัะฟัะฐะฒะปะตะฝะฐ ะพัะธะฑะบะฐ ั ะผะฐััะธะฒะพะผ ะฒ Log::add)
- โ Try-catch ะดะปั ะบะฐะถะดะพะณะพ ะฟัะพะฒะฐะนะดะตัะฐ
- โ ะะตัะฐะปัะฝัะต ะปะพะณะธ ะฟัะพัะตััะฐ

### ะะพะฝัะฐะบัั ะฟะพะดะดะตัะถะบะธ ApiShip
- **ะกะฐะนั:** https://apiship.ru
- **ะะพะบัะผะตะฝัะฐัะธั API:** https://api.apiship.ru/doc/
- **ะขะตัะฟะพะดะดะตัะถะบะฐ:** ัะตัะตะท ะปะธัะฝัะน ะบะฐะฑะธะฝะตั

## ะกะปะตะดัััะธะต ัะฐะณะธ

1. โ ะะพะปััะธัั ะฟัะฐะฒะธะปัะฝัะน API ะบะปัั ะฒ ะปะธัะฝะพะผ ะบะฐะฑะธะฝะตัะต ApiShip
2. โ ะะฑะฝะพะฒะธัั ะบะปัั ะฒ ะฝะฐัััะพะนะบะฐั ะบะพะผะฟะพะฝะตะฝัะฐ
3. โ ะะฐะฟัััะธัั ะพะฑะฝะพะฒะปะตะฝะธะต ะะะ
4. โ ะัะพะฒะตัะธัั ัะตะทัะปััะฐั ัะตัะตะท `php check_apiship_db.php`
5. โ ะัะปะธ ะฝะต ะฟะพะผะพะณะปะพ - ะธัะฟัะฐะฒะธัั ัะพัะผะฐั ะทะฐะณะพะปะพะฒะบะฐ Authorization

---

**ะะฐัะฐ ะพััััะฐ:** 5 ะฝะพัะฑัั 2025 ะณ., 16:00
**ะกัะฐััั:** ะขัะตะฑัะตััั ะฝะพะฒัะน API ะบะปัั ApiShip
